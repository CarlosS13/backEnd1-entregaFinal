<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Productos en Tiempo Real</title>
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <h1>Productos en Tiempo Real</h1>
  <ul id="product-list">
    {{#each products}}
      <li data-id="{{this.id}}">
        <strong>{{this.title}}</strong> - {{this.description}} - ${{this.price}}
        <button onclick="deleteProduct({{this.id}})">Eliminar</button>
      </li>
    {{/each}}
  </ul>

  <h2>Agregar Producto</h2>
  <form id="add-product-form">
    <input type="text" name="title" placeholder="Título" required>
    <input type="text" name="description" placeholder="Descripción" required>
    <input type="number" name="price" placeholder="Precio" required>
    <button type="submit">Agregar</button>
  </form>

  <script>
    const socket = io();

    socket.on('products', (products) => {
      const list = document.getElementById('product-list');
      list.innerHTML = '';
      products.forEach(product => {
        const li = document.createElement('li');
        li.setAttribute('data-id', product.id);
        li.innerHTML = `<strong>${product.title}</strong> - ${product.description} - $${product.price}
          <button onclick="deleteProduct(${product.id})">Eliminar</button>`;
        list.appendChild(li);
      });
    });

    document.getElementById('add-product-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const product = {};
      formData.forEach((value, key) => product[key] = key === 'price' ? Number(value) : value);
      socket.emit('addProduct', product);
      this.reset();
    });
    function deleteProduct(id) {
      socket.emit('deleteProduct', id);
    }
  </script>
</body>
</html>